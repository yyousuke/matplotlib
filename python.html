<!doctype html>
<html>
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M077D60Y90"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M077D60Y90');
</script>

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="author" content="山下陽介 (Yousuke Yamashita)  国立環境研究所 (National Institute for Environmental Studies, NIES)" />
<link rel="icon" type="image/vnd.microsoft.icon" href="/matplotlib/favicon.ico" />
<link rel="apple-touch-icon" type="image/png" href="/matplotlib/images/apple-touch-icon-180x180.png" />
<link rel="icon" type="image/png" href="/matplotlib/images/icon-192x192.png" />
<link rel="icon" type="image/x-icon" href="/matplotlib/favicon.ico" />
<!-- Mobile Internet Explorer allows us to activate ClearType technology for smoothing fonts for easy reading -->
<meta http-equiv="cleartype" content="on" />
<!-- Specify whether or not telephone numbers in the HTML content should appear as hypertext links -->
<meta name="format-detection" content="telephone=no" />
<!-- Changes the logical window size used when displaying a page mobile browsers -->
<meta name = "viewport" content = "width = device-width, initial-scale=1, user-scalable=yes" />

<meta name="robots" content="all" />
<meta name="http-equiv" content="X-Robots-Tag : all" />
<meta name="googlebot" content="all" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<link href="design.css" rel="stylesheet" type="text/css" />
<title>気象データ解析のためのmatplotlibの使い方：PythonのTIPS</title>
<meta property="og:title" content="気象データ解析のためのmatplotlibの使い方：PythonのTIPS" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://yyousuke.github.io/matplotlib/python.html" />
<meta property="og:image" content="https://yyousuke.github.io/matplotlib/images/logo.png" />
<meta property="og:site_name" content="気象データ解析のためのmatplotlibの使い方：PythonのTIPS" />
<meta property="og:description" content="Pythonによるデータ処理のTIPSを載せています" />
<meta property="fb:app_id" content="902607720378666" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@yyousuke1109" />
<meta name="twitter:player" content="@yyousuke1109" />
</head>

<body>

<div id="nesting">
<a href="/">ホーム</a> &gt; <a href="index.html">matplotlibの使い方</a> &gt; python
</div>
<article>
<h1 id="top">PythonのTIPS</h1>
<br />
<!-- 目次 -->
<h2 id="contents">目次</h2>
<div class="contents">
  <!-- 時刻形式 -->
  <ul class="list1"><li><a href="#time">時刻形式</a>
    <ul class="list2">
      <li><a href="#time_1">時刻形式データの作成</a></li>
      <li><a href="#time_2">時刻形式データから年、月、日などを取り出す</a></li>
      <li><a href="#time_3">時刻形式データから書式指定して取り出す</a></li>
      <li><a href="#time_4">時刻形式データの演算</a></li>
      <li><a href="#time_5">1ヶ月後、1年後を計算する</a></li>
      <li><a href="#time_6">月末の日を計算する</a></li>
      <li><a href="#time_7">年初からの日数を計算する</a></li>      
      <li><a href="#time_8">当日の00UTCを取得する</a></li>
      <li><a href="#time_9">年初の00UTCを取得する</a></li>
      <li><a href="#time_10">ISOフォーマットで表示する</a></li>
      <li><a href="#time_11">時間方向のループを回す</a></li>
      <li><a href="#time_12">毎日の同じ時刻の計算</a></li>
     </ul>
  </li></ul>
  <!-- ディレクトリ、ファイル -->
  <ul class="list1"><li><a href="#dir">ディレクトリ、ファイル</a>
    <ul class="list2">
      <li><a href="#dir_1">ディレクトリのパスを結合する</a></li>
      <li><a href="#dir_2">ディレクトリ、ファイルが存在するか確認する</a></li>
      <li><a href="#dir_3">ディレクトリ内の一覧を取得する</a></li>
      <li><a href="#dir_4">ワイルドカードで一覧を取得する</a></li>
      <li><a href="#dir_5">ディレクトリ、ファイルの所有者、グループを変更する</a></li>
      <li><a href="#dir_6">ディレクトリ、ファイルのパーミッションを変更する</a></li>
      <li><a href="#dir_7">ディレクトリを作成する</a></li>
      <li><a href="#dir_8">ディレクトリ、ファイルを削除する</a></li>
      <li><a href="#dir_9">シンボリックリンクを作成する</a></li>
      <li><a href="#dir_10">ディレクトリ、ファイルをコピー、移動する</a></li>
      <li><a href="#dir_11">カレントディレクトリを移動する</a></li>   
     </ul>
  </li></ul>
  <!-- 環境変数 -->
  <ul class="list1"><li><a href="#env">環境変数</a>
    <ul class="list2">
      <li><a href="#env_1">環境変数を取得する</a></li>
      <li><a href="#env_2">環境変数を追加・上書きする</a></li>
      <li><a href="#env_3">pythonパッケージへのパスを追加する</a></li>
      <li><a href="#env_4">コマンドにパスが通っているか確認する</a></li>   
     </ul>
  </li></ul>
  <!-- 文字列 -->
  <ul class="list1"><li><a href="#char">文字列</a>
    <ul class="list2">
      <li><a href="#char_1">大文字と小文字の変換</a></li>
      <li><a href="#char_2">文字列から改行記号を取り除く</a></li>
      <li><a href="#char_3">文字列からboolへの変換</a></li>
     </ul>
  </li></ul>
  <!-- 条件式 -->
  <ul class="list1"><li><a href="#if">条件式</a>
    <ul class="list2">
      <li><a href="#if_1">pythonにおける真偽値の判定</a></li>
      <li><a href="#if_2">全ての要素がTrueか判定する</a></li>
      <li><a href="#if_3">いずれかの要素がTrueか判定する</a></li>
      <li><a href="#if_4">全ての要素がFalseか判定する</a></li>
      <li><a href="#if_5">オブジェクト同士の比較</a></li>
     </ul>
  </li></ul>
  <!-- リスト -->
  <ul class="list1"><li><a href="#list">リスト</a>
    <ul class="list2">
      <li><a href="#list_1">pythonにおけるリスト</a></li>
      <li><a href="#list_2">リストの作成</a></li>
      <li><a href="#list_3">リストの要素の変更</a></li>
      <li><a href="#list_4">リストへの追加</a></li>
      <li><a href="#list_5">リスト同士の結合</a></li>
    </ul>
  </li></ul>
  <!-- タプル -->
  <ul class="list1"><li><a href="#tuple">タプル</a>
    <ul class="list2">
      <li><a href="#tuple_1">pythonにおけるタプル</a></li>
      <li><a href="#tuple_2">タプルの作成</a></li>
    </ul>
  </li></ul>
  <!-- 集合 -->
  <ul class="list1"><li><a href="#set">集合</a>
    <ul class="list2">
      <li><a href="#set_1">pythonにおける集合</a></li>
      <li><a href="#set_2">集合同士の演算</a></li>
    </ul>
  </li></ul>
  <!-- 辞書 -->
  <ul class="list1"><li><a href="#dict">辞書</a>
    <ul class="list2">
      <li><a href="#dict_1">pythonにおける辞書</a></li>
      <li><a href="#dict_2">辞書の作成</a></li>
      <li><a href="#dict_3">辞書の変更・追加</a></li>
      <li><a href="#dict_4">辞書同士の結合</a></li>
    </ul>
  </li></ul>
  <!-- Web -->
  <ul class="list1"><li><a href="#web">Web</a>
    <ul class="list2">
      <li><a href="#web_1">pythonでwebサーバを起動</a></li>
      <li><a href="#web_2">ファイルをダウンロードする</a></li>
      <li><a href="#web_3">ダウンロードにリトライ回数を設定する</a></li>
     </ul>
  </li></ul>
  <!-- 設定ファイル -->
  <ul class="list1"><li><a href="#config">設定ファイル</a>
    <ul class="list2">
      <li><a href="#config_1">設定ファイルの形式</a></li>
      <li><a href="#config_2">設定ファイルの読み込み</a></li>
      <li><a href="#config_3">設定ファイルの書き出し</a></li>
     </ul>
  </li></ul>
  <!-- 例外処理 -->
  <ul class="list1"><li><a href="#exception">例外処理</a>
    <ul class="list2">
      <li><a href="#exception_1">例外処理の概要</a></li>
      <li><a href="#exception_2">例外処理の記述方法</a></li>
      <li><a href="#exception_3">例外を補足し終了コードを返す</a></li>
      <li><a href="#exception_4">subprocessの例外を補足する</a></li>
     </ul>
  </li></ul>
  <!-- 外部コマンド -->
  <ul class="list1"><li><a href="#ext">外部コマンド</a>
    <ul class="list2">
      <li><a href="#ext_1">外部コマンドの実行</a></li>
      <li><a href="#ext_2">シェルを利用した外部コマンドの実行</a></li>
      <li><a href="#ext_3">外部コマンドの戻り値を取得する</a></li>
     </ul>
  </li></ul>
  <!-- その他 -->
  <ul class="list1"><li><a href="#misc">その他</a>
    <ul class="list2">
      <li><a href="#misc_1">QRコードを生成する</a></li>
      <li><a href="#misc_2">base64でエンコードする</a></li>
     </ul>
  </li></ul>
</div>
<small><a href="#top">[top]</a></small> <br />
<br />
<hr width="105%" />
<br />

<!-- ここから本文 -->
<!-- 時刻形式 -->
<h3><div class="headline1" id="time">時刻形式</div></h3>
<h4><div class="headline2" id="time_1">時刻形式データの作成</div></h4>
<div class="text1">
datetimeで扱うことのできる時刻形式データを作成する
<ul class="list1">
<li>datetime.dateを使う（日付のみを扱う場合）
<pre>
from datetime import date
time = date(年, 月, 日)
</pre>
年、月、日は整数で与える
</li><br />
<li>datetime.datetimeを使う（日付と時刻を扱う場合）
<pre>
from datetime import datetime
time = datetime(年, 月, 日, 時, 分, 秒)
</pre>
年、月、日、時、分、秒は整数で与える
</li><br />
<li>現在時刻を与える場合（ローカルタイム）
<pre>
from datetime import datetime
time = datetime.now()
</pre>
システム時刻をローカルタイムで取得
</li><br />
<li>現在時刻を与える場合（UTC）
<pre>
from datetime import datetime
time = datetime.utcnow() 
</pre>
システム時刻をUTCで取得
</li><br />
<li>pandas.to_datetimeを使う（文字列から日付と時刻に変換）
<pre>
import pandas as pd
time = pd.to_datetime("年-月-日 時:分:秒") # ISO形式の場合
</pre>
例えば、"2021-09-04 12:00:00"のような形式<br /><br />
次のように、"20210904120000"のような数字の羅列でもよい
<pre>
time = pd.to_datetime("年月日時分秒")
</pre>
</li>
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="time_2">時刻形式データから年、月、日などを取り出す</div></h4>
<div class="text1">
時刻形式データ.取り出したい要素
<ul class="list1">
<li>datetime.dateの場合
<pre>
from datetime import date
time = date(2021, 9, 4)
print(time.year)
print(time.moth)
print(time.day)
</pre>
time.yearで2021、time.monthで9、time.dayで4が整数値で返される<br />
時、分、秒を表示しようとするとエラーになる</li><br />
<li>datetime.datetimeの場合
<pre>
from datetime import datetime
time = datetime(2021, 9, 4, 12, 30, 0)
print(time.year)
print(time.moth)
print(time.day)
print(time.hour)
print(time.minute)
print(time.second)
</pre>
time.yearで2021、time.monthで9、time.dayで4、time.hourで12、time.minuteで30、time.secondで0が整数値で返される<br />
pandas.to_datetimeの場合も挙動は同じ</li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="time_3">時刻形式データから書式指定して取り出す</div></h4>
<div class="text1">
datetime.strftimeを使う
<ul class="list1">
<li>年/月/日
<pre>
from datetime import datetime
time = datetime(2021, 9, 4, 12, 30, 0)
print(time.strftime("%Y/%m/%d"))
</pre>
"2021/09/04"の文字列が表示される<br />
時刻表記の書式については<a href="forms.html#time">時刻表記に用いられる書式指定子一覧</a>参照</li><br />
<li>年/月/日 時:分:秒
<pre>
from datetime import datetime
time = datetime(2021, 9, 4, 12, 30, 0)
print(time.strftime("%Y/%m/%d %H:%M:%S"))
</pre>
"2021/09/04 12:30:00" の文字列が表示される</li><br />
<li>ISOフォーマット
<pre>
from datetime import datetime
time = datetime(2021, 9, 4, 12, 30, 0)
print(time.isoformat())
</pre>
"2021-09-04T12:30:00" の文字列が表示される<br />
詳細は<a href="#time_7">ISOフォーマットで表示する</a>参照</li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="time_4">時刻形式データの演算</div></h4>
<div class="text1">
datetime.timedeltaを使うことで時刻形式データの演算を行うことができる
<ul class="list1">
<li>datetime.datetimeで作成したものを利用
<pre>
from datetime import datetime, timedelta
time = datetime(2021, 9, 4, 12, 0, 0)
time_new = time + timedelta(hours=12)
</pre>
9/4 12時から12時間後の9/5 0時になる
</li><br />
<li>日単位での演算も可能
<pre>
from datetime import datetime, timedelta
time = datetime(2021, 9, 4, 12, 0, 0)
time_new = time + timedelta(days=2)
</pre>
9/4 12時から2日後の9/6 12時になる
</li><br />
<li>減算することもできる
<pre>
from datetime import datetime, timedelta
time = datetime(2021, 9, 4, 12, 0, 0)
time_new = time - timedelta(days=2)
</pre>
9/4 12時から2日前の9/2 12時になる
</li><br />
<li>pandas.to_datetimeで作成したものを利用
<pre>
import pandas as pd
from datetime import timedelta
time = pd.to_datetime("20210904120000")
time_new = time + timedelta(hours=12)
</pre>
datetimeで作成した場合と同様に演算可能
</li>
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="time_5">1ヶ月後、1年後を計算する</div></h4>
<div class="text1">
datetime.timedeltaでは、1ヶ月後、1年後などを指定するとエラーになる<br />
dateutil.relativedeltaを使うと加算・減算が可能
<ul class="list1">
<li>1ヶ月後の計算
<pre>
from datetime import datetime
from dateutil.relativedelta import relativedelta
time_cur = datetime(2021, 9, 4, 12, 0, 0)
time_new = time_cur + relativedelta(months=1)
</pre>
9/4 12時から1ヶ月後の10/4 12時になる
</li><br />
<li>1年後の計算
<pre>
from datetime import datetime
from dateutil.relativedelta import relativedelta
time_cur = datetime(2021, 9, 4, 12, 0, 0)
time_new = time_cur + relativedelta(years=1)
</pre>
2021/9/4 12時から1年後の2022/9/4 12時になる
</li><br />
<li>閏年をまたいだ場合
<pre>
from datetime import datetime
from dateutil.relativedelta import relativedelta
time_cur = datetime(2021, 9, 4, 12, 0, 0)
time_new = time_cur + relativedelta(years=4)
</pre>
閏年をまたいでも、4年後の同じ日の2025/9/4 12時になる
</li>
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="time_6">月末の日を計算する</div></h4>
<div class="text1">
dateutil.relativedeltaの１ヶ月後の計算を応用して月末の日を計算する
<pre>
from datetime import datetime
from dateutil.relativedelta import relativedelta
time_cur = datetime(2021, 8, 1, 0, 0, 0)
time_new = time_cur + relativedelta(months=1) - relativedelta(days=1)
print(time_new)
</pre>
2021-08-31 00:00:00が表示される<br />
この計算では月初を指定しないといけないので、time_curがいつでも月末の日を計算できるように変更する
<pre>
time_cur = datetime.now()
time_new = time_cur.replace(day=1) + relativedelta(months=1) - relativedelta(days=1)
print(time_new.strftime('%Y-%m-%d'))
</pre>
今月の月末の日が表示される
</div>
<br />
<br />

<h4><div class="headline2" id="time_7">年初からの日数を計算する</div></h4>
<div class="text1">
datetimeの演算を利用する
<pre>
from datetime import datetime
doy = (datetime(2021, 6, 21) - datetime(2021, 1, 1)).days
print(doy)
</pre>
171が表示される（1/1が0、1/2が1、、、で計算されたもの）
</div>
<br />
<br />

<h4><div class="headline2" id="time_8">当日の00UTCを取得する</div></h4>
<div class="text1">
datetime.utcnowで取得した現在時刻を書き換える
<pre>
from datetime import datetime
time = datetime.utcnow().replace(hour=0, minute=0, second=0, microsecond=0)
</pre>
時、分、行、マイクロ秒を全て0に書き換え当日の00UTCにする
</div>
<br />
<br />

<h4><div class="headline2" id="time_9">年初の00UTCを取得する</div></h4>
<div class="text1">
<a href="#time_8">当日の00UTCを取得する</a>場合と同様に、datetime.utcnowで取得した現在時刻を書き換える
<pre>
from datetime import datetime
time = datetime.utcnow().replace(month=1, day=1, hour=0, minute=0, second=0, microsecond=0)
</pre>
月を1月、日を1日とし、時、分、行、マイクロ秒を全て0に書き換え年初の00UTCにする
</div>
<br />
<br />

<h4><div class="headline2" id="time_10">ISOフォーマットで表示する</div></h4>
<div class="text1">
datetime.datetimeのisoformatメソッドを利用する
<ul class="list1">
<li>デフォルトのISO date表示
<pre>
from datetime import datetime
dt = datetime(2022, 3, 8, 12, 31, 12)
print(dt.isoformat())
print(type(dt.isoformat()))
出力：
2022-03-08T12:31:12（デフォルトでは日付と時刻の間にTが入り、秒まで）
&lt;class 'str'&gt;（文字型に変換されている）
</pre>
</li><br />
<li>日付と時刻の間を空白にする
<pre>
from datetime import datetime
dt = datetime(2022, 3, 8, 12, 31, 12)
print(dt.isoformat(' '))
出力：
2022-03-08 12:31:12
</pre>
</li><br />
<li>ミリ秒まで表示する
<pre>
from datetime import datetime
dt = datetime(2022, 3, 8, 12, 31, 12)
print(dt.isoformat(timespec='milliseconds'))
出力：
2022-03-08T12:31:12.000
</pre>
</li><br />
<li>日付と時刻の間を空白、ミリ秒まで表示
<pre>
from datetime import datetime
dt = datetime(2022, 3, 8, 12, 31, 12)
print(dt.isoformat(sep=' ', timespec='milliseconds'))
出力：
2022-03-08 12:31:12.000
</pre>
sepオプションは省略可能
</li><br />
<li>マイクロ秒まで表示する
<pre>
from datetime import datetime
dt = datetime(2022, 3, 8, 12, 31, 12, 30)
print(dt.isoformat(timespec='microseconds'))
出力：
2022-03-08T12:31:12.000030
</pre>
datetimeの7番目の引数にマイクロ秒を与えることができる
</li><br />
<li>分まで表示する
<pre>
from datetime import datetime
dt = datetime(2022, 3, 8, 12, 31, 12)
print(dt.isoformat(timespec='minutes'))
出力：
2022-03-08T12:31
</pre>
</li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="time_11">時間方向のループを回す</div></h4>
<div class="text1">
多重ループは遅くなるので時刻変数は1つのみとし、timedeltaを足して時刻を進める
<ul class="list1">
<li>time_staからtime_endまで
<pre>
from datetime import datetime, timedelta
time_sta = datetime(2022, 9, 1, 0, 30, 0) # 開始時刻（2022/09/01 00:30:00）
time_end = datetime(2022, 9, 2, 12, 30, 0) # 終了時刻（2022/09/02 12:30:00）
time_step = timedelta(hours=1) # 時刻を進める間隔（1時間）
time_now = time_sta
while True:
&nbsp; &nbsp; if time_now &lt;= time_end:
&nbsp; &nbsp; &nbsp; &nbsp; latest_time = time_now.strftime("%Y-%m-%d %H:%M:%S")
&nbsp; &nbsp; &nbsp; &nbsp; print(latest_time)
&nbsp; &nbsp; else:
&nbsp; &nbsp; &nbsp; &nbsp; break # time_endを超えたら終了
&nbsp; &nbsp; # time_step分時刻を進める
&nbsp; &nbsp; time_now = time_now + time_step
</pre>
＊1日刻みにしたい場合には、time_step = timedelta(days=1)<br />
＊1ヶ月で刻みたい場合には、dateutil.relativedeltaをimportしてtime_stepを設定する
<pre>from dateutil.relativedelta import relativedelta
time_step = timedelta(months=1)
</pre>
</li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="time_12">毎日の同じ時刻の計算</div></h4>
<div class="text1">
開始時刻（1970-01-01 00:00:00）からの差を1日で割った余りを求める
<ul class="list1">
<li>Pandasの場合
<pre>import pandas as pd
base_time = pd.Timestamp(0)
time = (df_time - base_time) % pd.Timedelta(1, 'D')
</pre>
＊df_timeはPandasのSeriesで時刻情報が入っている場合
</li><br />
<li>Numpyの場合
<pre>import numpy as np
base_time = np.datetime64(0, 'ns')
time = (df_time.to_numpy() - base_time) % np.timedelta64(1, 'D')
</pre>
＊df_timeはPandasのSeriesかDataFrame
</li><br />
</ul>
</div>
<br />
<br />


<!-- ディレクトリ、ファイル -->
<h3><div class="headline1" id="dir">ディレクトリ、ファイル</div></h3>
<h4><div class="headline2" id="dir_1">ディレクトリのパスを結合する</div></h4>
<div class="text1">
os.path.joinを使う
<pre>
import os
dir1 = "dir_name1"
dir2 = "dir_name2"
dir_path = os.path.join(dir1, dir2)
</pre>
dir_pathには、UNIX環境ではdir_name1/dir_name2が入る<br />
UNIX環境では/、Windows環境では&#165;が設定されるので、OSに依存しないコードが書ける
</div>
<br />
<br />

<h4><div class="headline2" id="dir_2">ディレクトリ、ファイルが存在するか確認する</div></h4>
<div class="text1">
os.path.existsを使う
<pre>
import os
os.path.exists("ディレクトリ、ファイルのパス")
</pre>
存在すればTrueが返る
<ul class="list1">
<li>ディレクトリが存在するか確認する
<pre>
os.path.isdir("ディレクトリのパス")
</pre>
ディレクトリが存在する場合はTrue
</li><br />
<li>ファイルが存在するか確認する
<pre>
os.path.isfile("ファイルのパス")
</pre>
ファイルが存在する場合はTrue
</li><br />
<li>リンクを確認する
<pre>
os.path.islink("ディレクトリ、ファイルのパス")
</pre>
存在するリンクの場合はTrue
</li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="dir_3">ディレクトリ内の一覧を取得する</div></h4>
<div class="text1">
os.listdirを使うと、ディレクトリ内のファイル、サブディレクトリ一覧を取得できる
<ul class="list1">
<li>現在のディレクトリ内の一覧を表示する
<pre>
import os
print(os.listdir("."))
</pre>
</li><br />
<li>ディレクトリ内のファイル一覧を取得し、パスを表示
<pre>
import os
input_dir = "ディレクトリのパス"
files = os.listdir(input_dir) # この時点ではサブディレクトリも含まれる
for f in [f for f in files if os.path.isfile(f)]:
&nbsp; &nbsp; print(os.path.join(input_dir, f))
</pre>
ファイルの場合にTrueを返すos.path.isfile()を使った
</li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="dir_4">ワイルドカードで一覧を取得する</div></h4>
<div class="text1">
glob.glob関数を使うと、UNIXライクなワイルドカードで一致するファイル、ディレクトリを取得できる
<pre>
import glob
files = glob.glob("ワイルドカードを含む記述")
</pre>
直下のtest1/*.txtをリストにする
<pre>
import glob
files = glob.glob("test1/*.txt")
</pre>
</div>
<br />
<br />

<h4><div class="headline2" id="dir_5">ディレクトリ、ファイルの所有者、グループを変更する</div></h4>
<div class="text1">
os.chownを使う
<pre>
import os
os.chown("ディレクトリ、ファイル名", uid, gid)
</pre>
＊指定されたuid、gid（整数型）に変更する<br />
＊いずれかを変更しない場合には、-1を指定する
<ul class="list1">
<li>dir01のGIDを5000に変更する
<pre>
os.chown("dir01", -1, 5000)
</pre>
実行するユーザが変更前・変更後の両方のグループに所属していない場合はエラー
</li><br />
<li>dir01/file01.txtのUIDを1040に変更する
<pre>
os.chown("dir01/file01.txt", 1040, -1)
</pre>
所有者を変更できるのはroot権限で実行した場合のみ<br />
</li>
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="dir_6">ディレクトリ、ファイルのパーミッションを変更する</div></h4>
<div class="text1">
os.chmodを使う
<ul class="list1">
<li>file01を誰でも読み込み可能にする（所有者は書き込みも可能）
<pre>
os.chmod("file01", 0o644)
</pre>
＊0644でも有効な場合もあるがエラーが出る場合は、この記述を使う
</li><br />
<li>file01を誰でも読み込み実行可能にする（所有者は書き込みも可能）
<pre>
os.chmod("file01", 0o755)
</pre>
</li><br />
<li>dir01を誰でも読み込み実行可能にする（所有者は書き込みも可能）
<pre>
os.chmod("dir01", 0o755)
</pre>
＊ディレクトリの場合、実行可能権限がないとディレクトリ内にアクセスできないことに注意（ディレクトリ内のリストを表示するには、読み込み権限が必要）
</li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="dir_7">ディレクトリを作成する</div></h4>
<div class="text1">
os.makedirsを使う
<pre>
import os
os.makedirs("ディレクトリのパス")
</pre>
＊mkdir -p同様に、存在しない場合には親ディレクトリも作成する
</div>
<br />
<br />

<h4><div class="headline2" id="dir_8">ディレクトリ、ファイルを削除する</div></h4>
<div class="text1">
os.removeを使う
<pre>
import os
os.remove("削除するディレクトリ、ファイルのパス")
</pre>
＊ディレクトリの場合、rm -r ディレクトリのパス と同じ動作をする（ディレクトリごと削除）
</div>
<br />
<br />

<h4><div class="headline2" id="dir_9">シンボリックリンクを作成する</div></h4>
<div class="text1">
os.symlinkを使う
<pre>
import os
os.symlink("リンク元のパス", "リンク先のパス")
</pre>
</div>
<br />
<br />

<h4><div class="headline2" id="dir_10">ディレクトリ、ファイルをコピー、移動する</div></h4>
<div class="text1">
shutilを使う
<ul class="list1">
<li>例：コピーする場合
<pre>
import shutil
shutil.copy("コピー元のパス", "コピー先のパス")
</pre></li>
<li>例：移動する場合
<pre>
import shutil
shutil.move("移動元のパス", "移動先のパス")
</pre></li>
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="dir_11">カレントディレクトリを移動する</div></h4>
<div class="text1">
os.chdirを使う
<pre>
import os
os.chdir("移動先のパス")
</pre>
</div>
<br />
<br />


<!-- 環境変数 -->
<h3><div class="headline1" id="env">環境変数、パス</div></h3>
<h4><div class="headline2" id="env_1">環境変数を取得する</div></h4>
<div class="text1">
os.environ.getを使う
<ul class="list1">
<li>例：カレントディレクトリを取得する
<pre>
import os
cur = os.environ.get('PWD')
</pre>
カレントディレクトリは次の方法でも取得可能
<pre>cur = os.getcwd()</pre>
</li><br />
<li>例：LANGの取得
<pre>
import os
lang = os.environ.get('LANG', "C")
</pre>
取得できなかった場合は英語表記（C）に設定
</li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="env_2">環境変数を追加・上書きする</div></h4>
<div class="text1">
os.environを使う
<ul class="list1">
<li>例：rsyncに用いるコマンド設定（RSYNC_RSH）
<pre>
import os
os.environ['RSYNC_RSH'] = 'rsh'
</pre>
rshに設定される
</li><br />
<li>例：セキュリティ上好ましくないのでsshに変更する
<pre>
import os
os.environ['RSYNC_RSH'] = 'ssh'
</pre>
sshに上書きされる
</li><br />
</ul>
</div>

<h4><div class="headline2" id="env_3">pythonパッケージへのパスを追加する</div></h4>
<div class="text1">
sys.path.appendを使う
<ul class="list1">
<li>例：親ディレクトリをパスに追加する
<pre>
import sys
sys.path.append('../')
</pre>
</li>
<li>例：os.pardirを使う方法
<pre>
import sys
import os
sys.path.append(os.pardir)
</pre>
</li>
<li>例：環境変数に追加する（bash）
<pre>% export PYTHONPATH=設定したいパス:${PYTHONPATH}</pre>
</li>
<li>例：環境変数に追加する（python）
<pre>
import os
os.environ['PYTHONPATH'] = '設定したいパス'
</pre>
</li>
</ul>
</div>

<h4><div class="headline2" id="env_4">コマンドにパスが通っているか確認する</div></h4>
<div class="text1">
shutil.whichを使う
<pre>
import shutil
shutil.which("コマンド名")
</pre>
＊コマンドにパスが通っていれば、パスが表示される。<br /><br />
パスが通っていない場合の処理を指定する場合
<pre>
import shutil
if shutil.which("コマンド名") is None:
&nbsp; &nbsp; print("Not Found: コマンド名")
</pre>
＊パスが通っていない場合Noneを返すのを利用する
</div>
<br />
<br />



<!-- 文字列 -->
<h3><div class="headline1" id="char">文字列</div></h3>
<h4><div class="headline2" id="char_1">大文字と小文字の変換</div></h4>
<div class="text1">
文字列のメソッドを利用する
<ul class="list1">
<li>全て小文字にする
<pre>"ABc".lower()
出力：abc</pre>
</li><br />
<li>全て大文字にする
<pre>"aBc".upper()
出力：ABC</pre>
</li><br />
<li>大文字と小文字を逆にする
<pre>"aBc".swapcase()
出力：AbC</pre>
</li><br />
<li>先頭のみ大文字にする
<pre>"aBc".capitalize()
出力：Abc</pre>
</li><br />
<li>単語の先頭を大文字にする
<pre>"the abc".title()
出力：The Abc</pre>
</li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="char_2">文字列から改行記号を取り除く</div></h4>
<div class="text1">
文字列のメソッドを利用する
<ul class="list1">
<li>改行コード（LF）を取り除く
<pre>"文字列".replace('\n', '')</pre>
</li>
<li>改行コードを取り除く（rstrip使用）
<pre>"文字列".rstrip()</pre>
末尾の文字が取り除かれる
</li><br />
<li>両端（先頭、末尾）の文字を取り除く
<pre>"文字列".strip()</pre>
改行記号の他に先頭の空白なども取り除きたい場合
</li><br />
<li>タブを取り除く場合
<pre>"文字列".replace('\t', '')</pre>
</li>
<li>機種依存なく改行コードを取り除く
<pre>"".join("文字列".splitlines())</pre>
splitlinesでLFもCRLFも分割し、joinで結合する
</li><br />
<li>改行コードをLFに置き換える
<pre>"¥n".join("文字列".splitlines())</pre>
</li>
<li>読み取った文章から全ての改行記号を取り除く
<pre>
with open(file_name) as f:
&nbsp; &nbsp; words = f.readlines()
res = [line.rstrip() for line in words]</pre>
resには行毎のリストが入る
</li><br />
<li>検索した文字列が含まれる行のみリストに
<pre>
with open(file_name) as f:
&nbsp; &nbsp; words = f.readlines()
res = [line.rstrip() for line in words if '文字列' in line]</pre>
</li>
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="char_3">文字列からboolへの変換</div></h4>
<div class="text1">
文字列が"true"、"t"、"yes"、"1"のいずれかの場合にTrueとする。大文字・小文字を区別しないようにするため、lower()で小文字に変換している
<pre>
b = "文字列".lower() in ["true", "t", "yes", "1"]
</pre>
bにはTrueかFalseが入っている
</div>
<br />
<br />



 <!-- 条件式-->
<h3><div class="headline1" id="if">条件式</div></h3>
<h4><div class="headline2" id="if_1">pythonにおける真偽値の判定</div></h4>
<div class="text1">
<ul class="list1">
<li>真偽値</li>
<img src="./tables/Table4-4-2.png" class="size2" alt="Table" />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="if_2">全ての要素がTrueか判定する</div></h4>
<div class="text1">
allを用いる
<pre>
print(all([True, True, True]))
出力：True
print(all([True, True, False]))
出力：False
</pre>
＊全てTrueの時のみTrueが表示される<br />
＊allの引数には、リスト、タプル、集合が使用可能<br />
参考：<a href="https://note.nkmk.me/python-all-any-usage/">Pythonの組み込み関数all(), any()の使い方</a>
</div>
<br />
<br />

<h4><div class="headline2" id="if_3">いずれかの要素がTrueか判定する</div></h4>
<div class="text1">
anyを用いる
<pre>
print(any([True, False, False]))
出力：True
print(any([False, False, False]))
出力：False
</pre>
＊１つでもTrueが含まれていればTrueが表示される<br />
＊allの引数には、リスト、タプル、集合が使用可能
</div>
<br />
<br />

<h4><div class="headline2" id="if_4">全ての要素がFalseか判定する</div></h4>
<div class="text1">
not anyを用いる
<pre>
print(not any([False, False, False]))
出力：True
print(not any([False, False, True]))
出力：False
</pre>
＊anyの否定を取ることで、全ての要素がFalseの場合を判定できる<br />
＊allの引数には、リスト、タプル、集合が使用可能
</div>
<br />
<br />

<h4><div class="headline2" id="if_5">オブジェクト同士の比較</div></h4>
<div class="text1">
isinstence関数を用いる
<pre>isinstance(object, classinfo) </pre>
1番目の引数のオブジェクトが、2番目の引数で指定したデータ型のオブジェクトかサブクラスのオブジェクトの場合にTrueとなる
<ul class="list1">
<li>整数型か判断する
<pre>isinstance(1, int) 
出力：True
</pre>
</li>
<li>文字列型か判断する
<pre>isinstance(1, str) 
出力：False
isinstance("1", str) 
出力：True
</pre>
</li>
<li>整数か浮動小数点数のどちらかとの一致を判断する
<pre>isinstance(1, (int, float)) 
出力：True
isinstance(1.5, (int, float)) 
出力：True
isinstance("1.5", (int, float)) 
出力：False
</pre>
</li>
<li>bool型の場合
<pre>isinstance(True, int)
出力：True
</pre>
<pre>isinstance(False, int)
出力：True
</pre>
<pre>isinstance(True, bool)
出力：True
</pre>
<pre>isinstance(False, bool)
出力：True
</pre>
</li>
</ul>
</div>
<br />
<br />



<!-- リスト -->
<h3><div class="headline1" id="list">リスト</div></h3>
<h4><div class="headline2" id="list_1">pythonにおけるリスト</div></h4>
<div class="text1">
要素を順番に並べたもので中身を変更・追加・削除可能。要素の型はまちまちでも良く、リストの要素に文字列、整数、実数などの他、リストやタプル、Numpyの配列などオブジェクトは何でも入れられる。
</div>
<br />
<br />

<h4><div class="headline2" id="list_2">リストの作成</div></h4>
<div class="text1">
リストを作成する場合、次のように記述する
<pre>list_a = [1, 2, 4, 'a', 'b', 'c']</pre>
要素が空のリストも作成可能
<pre>list_a = []
list_b = list()</pre>
</div>
<br />

<h4><div class="headline2" id="list_3">リストの要素の変更</div></h4>
<div class="text1">
リストの要素番号を指定して値を置き換えることが可能
<pre>list_a[1] = 3
print(list_a)
出力：[1, 3, 4, 'a', 'b', 'c']
</pre>
</div>
<br />

<h4><div class="headline2" id="list_4">リストへの追加</div></h4>
<div class="text1">
リストの.appendを使う
<pre>list_a.append(5)
print(list_a)
出力：[1, 3, 4, 'a', 'b', 'c', 5]
</pre>
</div>
<br />

<h4><div class="headline2" id="list_5">リスト同士の結合</div></h4>
<div class="text1">
リストの.extendを使う
<pre>list_a = [1, 2, 4, 'a', 'b', 'c']
list_b = [5, 7, 10, 'd', 'e', 'f']
list_a.extend(list_b)
print(list_a)
出力：[1, 2, 4, 'a', 'b', 'c', 5, 7, 10, 'd', 'e', 'f']
</pre>
＊extendではなくappendを使うと、リストの中にリストが入る
<pre>list_a = [1, 2, 4, 'a', 'b', 'c']
list_b = [5, 7, 10, 'd', 'e', 'f']
list_a.append(list_b)
print(list_a)
出力：[1, 2, 4, 'a', 'b', 'c', [5, 7, 10, 'd', 'e', 'f']]
</pre>
</div>
<br />

<h4><div class="headline2" id="list_6">リスト内包表記</div></h4>
<div class="text1">
リストの要素を個別にstrに変換する場合
<pre>new_list_a = [str(x) for x in list_a]</pre>
例えば元のlist_aに数値のリストが入っている場合など<br />
<ul class="list1">
<li>1〜100までの数字
<pre>numbers = np.arange(1, 101)
num_list = [l for l in numbers]
</pre>
numbersに含まれるlを順にリストに追加
</li><br />
<li>3で割って1余る数のリスト（1〜100まで）
<pre>numbers = np.arange(1, 101)
num_list = [l for l in numbers if l % 3 == 1]
</pre>
後ろの条件式を満たした場合のみリストに追加される
</li><br />
</ul>
</div>
<br />


<!-- タプル -->
<h3><div class="headline1" id="tuple">タプル</div></h3>
<h4><div class="headline2" id="tuple_1">pythonにおけるタプル</div></h4>
<div class="text1">
<a href="#list">リスト</a>のように要素を順番に並べたものであるが、一度作成されたものは変更できない。要素の型はまちまちでも良く、タプルの要素に文字列、整数、実数などの他、リストやタプル、Numpyの配列などオブジェクトは何でも入れられる。
</div>
<br />
<br />

<h4><div class="headline2" id="tuple_2">タプルの作成</div></h4>
<div class="text1">
タプルを作成する場合、次のように記述する
<pre>tup_a = (1, 2, 'a')
print(tup_a)
出力：(1, 2, 'a')
</pre>
要素が1の場合、次のような記述ではタプルにならないので注意
<pre>tup_a = (1)
print(type(tup_a))
出力：&lt;class 'int'&gt;
</pre>
要素が1の場合、正しくは次のようにカンマを付けて記述する
<pre>tup_a = (1, )
print(type(tup_a))
出力：&lt;class 'tuple'&gt;
</pre>
</div>
<br />


<!-- 集合 -->
<h3><div class="headline1" id="set">集合</div></h3>
<h4><div class="headline2" id="set_1">pythonにおける集合</div></h4>
<div class="text1">
集合を作成する場合は、set()か{}を用いる。
<pre>
set_a = set("abc")
print(set_a)
</pre>
＊{'a', 'b', 'c'}が表示される
</div>
<br />
<br />

<h4><div class="headline2" id="set_2">集合同士の演算</div></h4>
<div class="text1">
集合同士の演算が可能
<pre>
set_a = set("abc") # {'a', 'b', 'c'}
set_b = set("cde") # {'c', 'e', 'd'}
print(set_a &amp; set_b) # and演算
出力；{'c'}
print(set_a | set_b) # or演算
出力：{'b', 'c', 'e', 'd', 'a'}
print(set_b - set_a) # 集合の差
出力： {'e', 'd'}
print(set_a - set_b) # 集合の差
出力： {'b', 'a'}
</pre>
</div>
<br />
<br />



<!-- 辞書 -->
<h3><div class="headline1" id="dict">辞書</div></h3>
<h4><div class="headline2" id="dict_1">pythonにおける辞書</div></h4>
<div class="text1">
キーと値のセットを順番に並べたもので、中身を変更・追加・削除可能。キーは文字型。値の型はまちまちでも良く、文字列、整数、実数などの他、リストやタプル、Numpyの配列などオブジェクトは何でも入れられる。
</div>
<br />
<br />

<h4><div class="headline2" id="dict_2">辞書の作成</div></h4>
<div class="text1">
辞書を作成する場合、次のように記述する
<pre>dict_a = {'a': 'value_a', 'b': 'value_b'}</pre>
要素が空の辞書も作成可能
<pre>dict_a = dict()</pre>
＊dict_a = {}でも空の辞書になるが、集合と紛らわしい<br />
<br />
dictを使って辞書を作成する場合、次のように記述
<pre>dict_a = dict(a = 'value_a', b = 'value_b')</pre>
</div>
<br />
<br />

<h4><div class="headline2" id="dict_3">辞書の変更・追加</div></h4>
<div class="text1">
新しいキーと値のペアを追加する
<pre>dict_a = {'a': 'value_a', 'b': 'value_b'}
dict_a['c'] = 'value_c'
print(dict_a)
出力：{'a': 'value_a', 'b': 'value_b', 'c': 'value_c'}
</pre>
既に存在しているキーを使用すると、値が更新される
<pre>dict_a['c'] = 'value_c2'
print(dict_a)
出力：{'a': 'value_a', 'b': 'value_b', 'c': 'value_c2'}
</pre>
</div>
<br />

<h4><div class="headline2" id="dict_4">辞書同士の結合</div></h4>
<div class="text1">
辞書dict_aとdict_bを結合する場合
<pre>dict_a = {'a': 'value_a', 'b': 'value_b'}
dict_b = {'c': 'value_c', 'd': 'value_d'}
dict_c = {**dict_a, **dict_b}
print(dict_c)
出力：{'a': 'value_a', 'b': 'value_b', 'c': 'value_c', 'd': 'value_d'}
</pre>
</div>
<br />
<br />



<!-- Web -->
<h3><div class="headline1" id="web">Web</div></h3>
<h4><div class="headline2" id="web_1">pythonでwebサーバを起動</div></h4>
<div class="text1">
Webページのコンテンツのある場所で以下のコマンドを実行する。
<pre>% python3 -m http.server 8000</pre>
ブラウザから次のようにアクセスする。
<pre>http://localhost:8000</pre>
＊テスト環境での使用を想定しており、公開サーバとはすべきではない
</div>
<br />
<br />

<h4><div class="headline2" id="web_2">ファイルをダウンロードする</div></h4>
<div class="text1">
urllib.requestを用いる
<pre>
import urllib.request
urllib.request.urlretrieve("URL", "保存するファイルのパス")
</pre>
</div>
<br />
<br />

<h4><div class="headline2" id="web_3">ダウンロードにリトライ回数を設定する</div></h4>
<div class="text1">
再帰関数を用いる
<pre>
import urllib.request
def download(cnt=2):
&nbsp; &nbsp; if cnt &lt;= 0:
&nbsp; &nbsp; &nbsp; &nbsp; raise RecursionError('maximum recursion count exceeded')
&nbsp; &nbsp; try:
&nbsp; &nbsp; &nbsp; &nbsp; urllib.request.urlretrieve("URL", "保存するファイルのパス")
&nbsp; &nbsp; except OSError:
&nbsp; &nbsp; &nbsp; &nbsp; time.sleep(10.0)  # 10秒間待つ
&nbsp; &nbsp; &nbsp; &nbsp; download(cnt=cnt - 1)  # cntを減らして再帰
</pre>
</div>
<br />
<br />



<!-- 設定ファイル -->
<h3><div class="headline1" id="config">設定ファイル</div></h3>
<h4><div class="headline2" id="config_1">設定ファイルの形式</div></h4>
<div class="text1">
次のように[セクション]で区切られ、各セクションに複数のキーと値のペアが配置されている。
<pre>
[Default]
SHELL = /bin/bash
TERM = xterm-256color
LANG = ja_JP.UTF-8

[filenames]
InputFileName = input.txt
OutputFileName = output.txt
</pre>
</div>
<br />
<br />

<h4><div class="headline2" id="config_2">設定ファイルの読み込み</div></h4>
<div class="text1">
<a href="#config_1">設定ファイル</a>をconfig.iniとして保存したものを読み込む例。
<pre>
import configparser
config = configparser.ConfigParser()
config.read("config.ini")
</pre>
<ul class="list1">
<li>セクションを表示する場合
<pre>print(config.sections())</pre>
出力：['Default', 'filenames']<br />
＊キーは大文字、小文字を区別する
</li><br />
<li>キーに対応する値を表示する場合
<pre>print(config["Default"]["SHELL"])</pre>
出力：/bin/bash</li><br />
<li>小文字にした場合
<pre>print(config["Default"]["shell"])</pre>
出力：/bin/bash<br />
＊キーは大文字、小文字を区別しない</li><br />
<li>セクション内のキーを全て表示する
<pre>
for key in config["Default"]:
&nbsp; &nbsp; print(key)
</pre>
出力：
<pre>
shell
term
lang
</pre></li><br />
<li>セクション内のキー、値のペアを全て表示する
<pre>
for key in config["Default"]:
&nbsp; &nbsp; print(key)
</pre>
出力：
<pre>
shell /bin/bash
term xterm-256color
lang ja_JP.UTF-8
</pre></li><br />
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="config_3">設定ファイルの書き出し</div></h4>
<div class="text1">
<a href="#config_1">設定ファイル</a>をconfig.iniとして出力するmkconfig.pyを作成する。
<pre>
#!/usr/bin/env python3
import configparser
config = configparser.ConfigParser()

config['Default'] = {
&nbsp; &nbsp; 'SHELL': '/bin/bash',
&nbsp; &nbsp; 'TERM': 'xterm-256color',
&nbsp; &nbsp; 'LANG': 'ja_JP.UTF-8'
}

config['filenames'] = {
&nbsp; &nbsp; 'InputFileName': 'input.txt',
&nbsp; &nbsp; 'OutputFileName': 'output.txt'
}

# 書き出し
with open('config.ini', 'w') as f:
&nbsp; &nbsp; config.write(f)
</pre>
＊出力されたファイルでは、次のようにキーが全て小文字となる。
<pre>
[Default]
shell = /bin/bash
term = xterm-256color
lang = ja_JP.UTF-8

[filenames]
inputfilename = input.txt
outputfilename = output.txt
</pre>
</div>
<br />
<br />



<!-- 例外処理 -->
<h3><div class="headline1" id="exception">例外処理の概要</div></h3>
<h4><div class="headline2" id="exception_1">例外処理の概要</div></h4>
<div class="text1">
すべての例外は BaseException（例外の基底クラス）から派生するが、BaseExceptionはユーザのコードでは使用しない<br />
コード中で例外を検出、生成する場合には、Exceptionから派生した組み込み例外を用いる<br />
例えば、モジュールのロードで問題が発生した場合には、ImportError、ファイルが存在しない、ディスク容量超過などシステム関連のエラーは OSError、など<br />
詳細については、<a href="https://docs.python.org/ja/3/library/exceptions.html">組み込み例外</a>参照
</div>
<br />
<br />

<h4><div class="headline2" id="exception_2">例外処理の記述方法</div></h4>
<div class="text1">
OSErrorの場合
<pre>
try:
&nbsp; &nbsp; 処理内容（ファイルを開けるなど）
except OSError as e:
&nbsp; &nbsp; raise OSError(e)
</pre>
OSErrorの内容を表示する<br />
exceptのみでも動作するが、PEP8では組み込み例外の名前を記載することになっている（except Exceptionは許容）
</div>
<br />
<br />

<h4><div class="headline2" id="exception_3">例外を補足し終了コードを返す</div></h4>
<div class="text1">
スクリプトの最上位で例外を補足し、終了コードを返す場合
<pre>
if __name__ == "__main__":
&nbsp; &nbsp; try:
&nbsp; &nbsp; &nbsp; &nbsp; main()
&nbsp; &nbsp; except Exception:
&nbsp; &nbsp; &nbsp; &nbsp; raise SystemExit(-1)
&nbsp; &nbsp; raise SystemExit(0)
</pre>
main関数が正常終了した場合は0、異常終了した場合は-1を返す
</div>
<br />
<br />

<h4><div class="headline2" id="exception_4">subprocessの例外を補足する</div></h4>
<div class="text1">
subprocessの終了コードを判定する
<pre>
com_list = ['コマンド', 'オプション1', 'オプション2', ...]
try:
&nbsp; &nbsp; res = subprocess.run(com_list,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stdout=subprocess.PIPE,
&nbsp; &nbsp; &nbsp; &nbsp; stderr=subprocess.PIPE)
except Exception:
&nbsp; &nbsp; exception = sys.exc_info()[1]
&nbsp; &nbsp; raise Exception(exception)
if res.returncode != 0:
&nbsp; &nbsp; raise Exception(Abort with return code ' + str(res.returncode))
</pre>
</div>
<br />
<br />



<!-- 外部コマンド -->
<h3><div class="headline1" id="ext">外部コマンド</div></h3>
<h4><div class="headline2" id="ext_1">外部コマンドの実行</div></h4>
<div class="text1">
subprocess.runを使う
<pre>
import subprocess
subprocess.run("コマンド", "引数1", "引数2", ...)
</pre>
</div>
<br />
<br />

<h4><div class="headline2" id="ext_2">シェルを利用した外部コマンドの実行</div></h4>
<div class="text1">
subprocess.runでshell=Trueとする
<pre>
import subprocess
subprocess.run("コマンド 引数1 引数2", shell=True)
</pre>
パイプも使用可能
<pre>
subprocess.run("コマンド1 引数1 引数2 | コマンド2", shell=True)
</pre>
＊shell=Trueでは、実行者の権限で任意のシェルコマンドを実行できてしまうので、使用は最小限に抑え、外部からの任意の入力を渡すことは避ける
</div>
<br />
<br />

<h4><div class="headline2" id="ext_3">外部コマンドの戻り値を取得する</div></h4>
<div class="text1">
subprocess.runの戻り値を利用する
<pre>
import subprocess
res = subprocess.run("コマンド", "引数1", "引数2", ..., stdout=subprocess.PIPE, stderr=subprocess.PIPE)
print(res.stdout.decode("utf-8")) # 標準出力の表示
print(res.stderr.decode("utf-8")) # 標準エラー出力の表示
print(str(res.returncode)) # 終了ステータスの表示
</pre>
＊pyton3標準のUTF-8への変換を行なっている
</div>
<br />
<br />



<!-- その他 -->
<h3><div class="headline1" id="misc">その他</div></h3>
<h4><div class="headline2" id="misc_1">QRコードを生成する</div></h4>
<div class="text1">
pyqrcodeを使う（pngで書き出す際はpypngも必要）。MacPortsの場合には、
<pre>% sudo port install py312-pypng py312-pyqrcode</pre>
py312の部分はpythonのバージョンに合わせて変更する。次のようにQRコードを生成する。
<pre>
import pyqrcode
# QRコード生成
code = pyqrcode.create("URLやメールアドレスなど", error='L', version=3, mode='binary')
# pngで保存
code.png("ファイル名.png", scale=5, module_color=[0, 0, 0, 128], background=[255, 255, 255])
</pre>
</div>
<br />
<br />

<h4><div class="headline2" id="misc_2">base64でエンコードする</div></h4>
<div class="text1">
base64を使う。MacPortsの場合には、
<pre>% sudo port install base64</pre>
次のように文字列をbase64に変換する。
<pre>import base64
enc = base64.b64encode('文字列')</pre>
<br />
DIASで提供されているJRA-3Q（<a href="https://doi.org/10.20783/DIAS.645" target="_blank">doi:10.20783/DIAS.645</a>）のダウンロードスクリプトに適用する場合
<ul class="list1">
<li>気圧面データ（1.25&deg;&times;1.25&deg;）の場合（変数毎に別ファイル）
<pre>import base64
from datetime import datetime, timedelta

base_url = 'https://data.diasjp.net/dl/storages/downloadCmd/'
prefix = 'anl_p125'
time_str = datetime(2024, 1, 1, 0, 0, 0) # 開始時刻
time_end = datetime(2024, 1, 31, 18, 0, 0) # 終了時刻
time_step = timedelta(hours=6) # 6時間毎
for var in ['ugrd', 'vgrd', 'depr', 'hgt', 'rh', 'spfh', 'vvel', 'relv', 'reld', 'vpot', 'strm']:
&nbsp; &nbsp; ofirst = True
&nbsp; &nbsp; time = time_str
&nbsp; &nbsp; time_bef = time_str - time_step
&nbsp; &nbsp; while True:
&nbsp; &nbsp; &nbsp; &nbsp; if time &gt; time_end:
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  break
&nbsp; &nbsp; &nbsp; &nbsp; if time.month != time_bef.month or ofirst: # 月に1度実行
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; YYMM = time.strftime('%Y%m') # YYMM形式
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dir_path = '/JRA3Q/Hist/Daily/' + prefix + '/' + YYMM + '/'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; file_name0 = prefix + '_' + var + '_L42.' + YYMM + '.ctl'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; file_name1 = prefix + '_' + var + '_L42.' + YYMM + '.idx'
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for file_name in [file_name0, file_name1]:
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dir_file = dir_path + file_name
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; enc = base64.b64encode(dir_file) # base64エンコード
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; access.dl(base_url + enc, dir_path, file_name) # ダウンロード（DIASのコード参照）
&nbsp; &nbsp; &nbsp; &nbsp; # 6時間毎のデータのダウンロード
&nbsp; &nbsp; &nbsp; &nbsp; ftime = time.strftime('%Y%m%d%H')
&nbsp; &nbsp; &nbsp; &nbsp; file_name = prefix + '_' + var + '.' + ftime
&nbsp; &nbsp; &nbsp; &nbsp; dir_file = dir_path + file_name
&nbsp; &nbsp; &nbsp; &nbsp; enc = base64.b64encode(dir_file) # base64エンコード
&nbsp; &nbsp; &nbsp; &nbsp; access.dl(base_url + enc, dir_path, file_name) # ダウンロード（DIASのコード参照）
&nbsp; &nbsp; &nbsp; &nbsp; time_bef = time
&nbsp; &nbsp; &nbsp; &nbsp; time = time + time_step
&nbsp; &nbsp; &nbsp; &nbsp; if ofirst:
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ofirst = False
</pre>
＊DIASで取得できるスクリプトに上記のコードを追記する
</li><br />
<li>表面データ（1.25&deg;&times;1.25&deg;）の場合（変数別のファイルなし）
<pre>
import base64
from datetime import datetime, timedelta

base_url = 'https://data.diasjp.net/dl/storages/downloadCmd/'
prefix = 'anl_surf125'
time_str = datetime(2024, 1, 1, 0, 0, 0) # 開始時刻
time_end = datetime(2024, 1, 31, 18, 0, 0) # 終了時刻
time_step = timedelta(hours=6) # 6時間毎
ofirst = True
time = time_str
time_bef = time_str - time_step
while True:
&nbsp; &nbsp; if time &gt; time_end:
&nbsp; &nbsp; &nbsp; &nbsp;  break
&nbsp; &nbsp; if time.month != time_bef.month or ofirst: # 月に1度実行
&nbsp; &nbsp; &nbsp; &nbsp; YYMM = time.strftime('%Y%m') # YYMM形式
&nbsp; &nbsp; &nbsp; &nbsp; dir_path = '/JRA3Q/Hist/Daily/' + prefix + '/' + YYMM + '/'
&nbsp; &nbsp; &nbsp; &nbsp; file_name0 = prefix + '.' + YYMM + '.ctl'
&nbsp; &nbsp; &nbsp; &nbsp; file_name1 = prefix + '.' + YYMM + '.idx'
&nbsp; &nbsp; &nbsp; &nbsp; for file_name in [file_name0, file_name1]:
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dir_file = dir_path + file_name
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; enc = base64.b64encode(dir_file) # base64エンコード
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; access.dl(base_url + enc, dir_path, file_name) # ダウンロード（DIASのコード参照）
&nbsp; &nbsp; # 6時間毎のデータのダウンロード
&nbsp; &nbsp; ftime = time.strftime('%Y%m%d%H')
&nbsp; &nbsp; file_name = prefix + '.' + ftime
&nbsp; &nbsp; dir_file = dir_path + file_name
&nbsp; &nbsp; enc = base64.b64encode(dir_file) # base64エンコード
&nbsp; &nbsp; access.dl(base_url + enc, dir_path, file_name) # ダウンロード（DIASのコード参照）
&nbsp; &nbsp; time_bef = time
&nbsp; &nbsp; time = time + time_step
&nbsp; &nbsp; if ofirst:
&nbsp; &nbsp; &nbsp; &nbsp; ofirst = False
</pre>
</li><br />
</ul>
</div>
<br />
<br />

<br />
<br />
<br />
<br />

<small><a href="#top">[top]</a></small> <br />
<hr width="105%" />
</article>
</body>
<footer>
<p>最終更新日：2024/12/15</p>
<p>Copyright (C) 2021-2024, Yousuke Yamashita, CC BY 4.0</p>
</footer>
</html>