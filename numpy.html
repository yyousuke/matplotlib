<!doctype html>
<html>
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M077D60Y90"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M077D60Y90');
</script>

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="author" content="山下陽介 (Yousuke Yamashita)  国立環境研究所 (National Institute for Environmental Studies, NIES)" />
<link rel="icon" type="image/vnd.microsoft.icon" href="/matplotlib/favicon.ico" />
<link rel="apple-touch-icon" type="image/png" href="/matplotlib/images/apple-touch-icon-180x180.png" />
<link rel="icon" type="image/png" href="/matplotlib/images/icon-192x192.png" />
<link rel="icon" type="image/x-icon" href="/matplotlib/favicon.ico" />
<!-- Mobile Internet Explorer allows us to activate ClearType technology for smoothing fonts for easy reading -->
<meta http-equiv="cleartype" content="on" />
<!-- Specify whether or not telephone numbers in the HTML content should appear as hypertext links -->
<meta name="format-detection" content="telephone=no" />
<!-- Changes the logical window size used when displaying a page mobile browsers -->
<meta name = "viewport" content = "width = device-width, initial-scale=1, user-scalable=yes" />

<meta name="robots" content="all" />
<meta name="http-equiv" content="X-Robots-Tag : all" />
<meta name="googlebot" content="all" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<link href="design.css" rel="stylesheet" type="text/css" />
<title>気象データ解析のためのmatplotlibの使い方：NumpyのTIPS</title>
</head>

<body>

<div id="nesting">
<a href="/">ホーム</a> &gt; <a href="index.html">matplotlibの使い方</a> &gt; Numpy
</div>
<article>
<h1 id="top">NumpyのTIPS</h1>
<br />

<!-- 目次 -->
<h2 id="contents">目次</h2>
<div class="contents">
  <!--  Numpyの数学関数 -->
  <ul class="list1"><li><a href="#math">Numpyの数学関数</a>
  </li></ul>
  <!--  Numpyの統計処理 -->
  <ul class="list1"><li><a href="#stat">Numpyの統計処理</a>
    <ul class="list2">
      <li><a href="#stat_1">Numpyの統計処理一覧</a></li>
      <li><a href="#stat_2">Numpyの統計処理一覧（欠損あり）</a></li>
     </ul>
  </li></ul>
  <!--  Numpyの判定関数 -->
  <ul class="list1"><li><a href="#is">Numpyの判定関数</a>
    <ul class="list2">
      <li><a href="#is_1">スカラー判定</a></li>
      <li><a href="#is_2">数であるかどうかを判定</a></li>
     </ul>
  </li></ul>
  <!-- Numpyのデータ形式 -->
  <ul class="list1"><li><a href="#dtype">Numpyのデータ形式</a>
    <ul class="list2">
      <li><a href="#dtype_1">Numpyのデータ型一覧</a></li>
      <li><a href="#dtype_2">Numpyバイナリデータ読み書きの書式一覧</a></li>
     </ul>
  </li></ul>
  <!--  Numpyの配列 -->
  <ul class="list1"><li><a href="#array_1">Numpyの配列</a>
    <ul class="list2">
      <li><a href="#array_1_1">配列ndarrayの作成</a></li>
      <li><a href="#array_1_2">配列の要素の置換</a></li>
      <li><a href="#array_1_3">配列の軸の入れ替え</a></li>
      <li><a href="#array_1_4">Numpy配列成分の演算</a></li>
      <li><a href="#array_1_5">配列</a></li>
     </ul>
  </li></ul>
</div>

<small><a href="#top">[top]</a></small> <br />
<br />
<hr width="105%" />
<br />

<!-- ここから本文 -->
<!-- Numpyの数学関数 -->
<h3><div class="headline1" id="math">Numpyの数学関数</div></h3>
<div class="text1">
<ul class="list1">
<li>Numpyの主要な数学関数一覧</li>
<img src="./tables/Table3-5-5.png" class="size2" alt="Table" /><br /><br />
</ul>
</div>
<br />
<br />

<!-- Numpyの統計処理 -->
<h3><div class="headline1" id="stat">Numpyの統計処理</div></h3>
<h4><div class="headline2" id="stat_1">Numpyの統計処理一覧</div></h4>
<div class="text1">
<ul class="list1">
<li>統計処理のインスタンスメソッド一覧（dataがインスタンスの場合）</li>
<img src="./tables/Table4-2-1.png" class="size2" alt="Table" /><br /><br />
</ul>
<p>dataがPandasのSeriesやNumpyのndarrayの場合</p>
<p>median、skew、kurtosisは、PandasのSeriesのみで利用可能</p>
</div>
<br />
<br />

<h4><div class="headline2" id="stat_2">Numpyの統計処理一覧（欠損あり）</div></h4>
<div class="text1">
<ul class="list1">
<li>Numpyの統計処理（欠損処理あり）</li>
<img src="./tables/Table4-2-1nan.png" class="size2" alt="Table" /><br /><br />
</ul>
<p>dataがPandasのSeriesやNumpyのndarrayの場合</p>
<p>data.nanmean()のようには使用できない</p>
</div>
<br />
<br />

<!-- Numpyの判定関数 -->
<h3><div class="headline1" id="is">Numpyの判定関数</div></h3>
<h4><div class="headline2" id="is_1">スカラー判定</div></h4>
<div class="text1">
オブジェクトがスカラーか判定する
<pre>np.isscalar(var)</pre>
数値、文字列、bool値はTrue、リスト、タプル、ndarrayなどはFalse<br />
＊<p href="https://numpy.org/doc/stable/reference/generated/numpy.isscalar.html">numpy.isscalar</p>参照<br />
</div>
<br />
<br />

<h4><div class="headline2" id="is_2">数であるかどうかを判定</div></h4>
<div class="text1">
数であることを判定したい場合には、以下のようにisinstanceを使う
<pre>
import numbers
isinstance(x, numbers.Number)
</pre>
</div>
<br />
<br />
  
<!-- Numpyのデータ形式 -->
<h3><div class="headline1" id="dtype">Numpyのデータ形式</div></h3>
<h4><div class="headline2" id="dtype_1">Numpyのデータ型一覧</div></h4>
<div class="text1">
<ul class="list1">
<li>Numpyのデータ型一覧</li>
<img src="./tables/Table6-4-4.png" class="size2" alt="Table" /><br /><br />
</ul>
<p>dtype=np.'型コード'</p>
</div>
<br />

<h4><div class="headline2" id="dtype_2">Numpyバイナリデータ読み書きの書式一覧</div></h4>
<div class="text1">
<ul class="list1">
<li>Numpyバイナリデータ読み書きの書式一覧</li>
<img src="./tables/Table6-4-5.png" class="size2" alt="Table" /><br /><br />
</ul>
<p>読み込む場合：d = np.fromfile('ファイル名', dtype='コード')</p>
<p>書き出す場合：np.array(d).astype('コード').tofile('ファイル名')</p>
<p>単精度浮動小数点型のコードはf4をfと省略可能</p>
</div>
<br />
<br />

<!-- Numpyの配列 -->
<h3><div class="headline1" id="array_1">Numpyの配列</div></h3>
<h4><div class="headline2" id="array_1_1">配列ndarrayの作成</div></h4>
<div class="text1">
<ul class="list1">
<li>配列ndarrayの作成（既存のデータから）<br />
入力データvarはlistなど
<pre>
np.array(var)
</pre>
</li>
<li>配列ndarrayの作成（作成後に形状変更）<br />
入力データvarの要素数が6で(3, 2)の2次元配列にする場合
<pre>
np.array(var).reshape(3, 2)
</pre>
</li>
<li>配列ndarrayの作成（定数）<br />
配列全部を同じ値に初期化する
<pre>
a = np.zeros((ndim, kdim, jdim, idim)) # 全ての要素が0
b = np.ones((ndim, kdim, jdim, idim)) # 全ての要素が1
c = np.ones((ndim, kdim, jdim, idim)) * 10.0 # 全ての要素が10
d = np.zeros((ndim, kdim, jdim, idim), dtype=np.int32) # 全ての要素が0、整数型を指定
</pre>
<p>idim：経度方向のグリッド数、jdim：緯度方向のグリッド数、kdim：高度方向のグリッド数、ndim：時間方向のグリッド数</p>
<p>Numpyで利用可能な型は<a href="#dtype_1">Numpyのデータ型一覧</a>参照</p>
</li>
</ul>
</div>

<h4><div class="headline2" id="array_1_2">配列の要素の置換</div></h4>
<div class="text1">
<ul class="list1">
<li>条件を満たす要素の置換<br />
負の値を0に置換
<pre>var[var &lt;= 0] = 0</pre>
</li>
<li>条件が真と偽で置換する値を変える<br />
負の値なら-1、正の値なら0に置換する
<pre>var = np.where(var &lt;= 0, -1, 0)</pre>
</li>
</ul>
</div>

<h4><div class="headline2" id="array_1_3">配列の軸の入れ替え</div></h4>
<div class="text1">
<ul class="list1">
<li>配列の転置<br />
varが２次元の行列の場合、次のいずれでも可能
<pre>
var = var.T
var = np.transpose(var)
</pre>
</li>
<li>配列の成分入れ替え<br />
配列varの成分を3、0、2、1の順に入れ替える
<pre>
var = var.transpose(3, 0, 2, 1)
</pre>
</li>
<li>内積<br />
配列x、yの内積を計算する
<pre>
np.dot(x, y)
</pre>
</li>
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="array_1_4">Numpy配列成分の演算</div></h4>
<div class="text1">
Numpyの機能で演算できる場合は極力そちらを使い、ループは用いない
<ul class="list1">
<li>経度、緯度方向のループを回す場合<br />
itertoolsを使うとループを1重化して高速化できる
<pre>
import itertools
i_list = np.arange(idim)
j_list = np.arange(jdim)
for ij in itertools.product(i_list, j_list):
&nbsp; &nbsp; i = ij[0]
&nbsp; &nbsp; j = ij[1]
&nbsp; &nbsp; 処理
</pre>
</li>
</ul>
</div>
<br />
<br />

<h4><div class="headline2" id="array_1_5">配列の平均操作</div></h4>
<div class="text1">
指定した軸で平均を作成する
<ul class="list1">
<li>2次元目の平均を作成する
<pre>d2 = d.mean(axis=1)</pre>
＊dが2次元以上の配列の場合<br />
＊<a href="#stat">Numpyの統計処理</a>参照
</li><br />
<li>時間、高度、経度、緯度の4次元配列で時間平均
<pre>d2 = d.mean(axis=0)</pre>
＊0次元目に時間軸が入っている場合
</li><br />
<li>経度、緯度の2次元配列で東西平均からの偏差
<pre>d2 = d - np.expand_dims(d.mean(axis=1), axis=1)</pre>
＊np.expand_dimsで2次元目を追加し、元のdと次元を合わせて演算可能にしている
＊例えば、dが64&times;128なら、d.mean(axis=1)で64になった配列が、np.expand_dimsで64&times;1になる
</ul>
</div>
<br />
<br />


<br />
<br />
<br />
<br />


<small><a href="#top">[top]</a></small> <br />
<hr width="105%" />
</article>
</body>
<footer>
<p>最終更新日：2024/12/30</p>
<p>Copyright (C) 2018-2024, Yousuke Yamashita, CC BY 4.0</p>
</footer>
</html>
