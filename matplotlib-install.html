<!doctype html>
<html>
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M077D60Y90"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M077D60Y90');
</script>

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="author" content="山下陽介 (Yousuke Yamashita)  国立環境研究所 (National Institute for Environmental Studies, NIES)" />
<link rel="icon" type="image/vnd.microsoft.icon" href="/matplotlib/favicon.ico" />
<link rel="apple-touch-icon" type="image/png" href="/matplotlib/images/apple-touch-icon-180x180.png" />
<link rel="icon" type="image/png" href="/matplotlib/images/icon-192x192.png" />
<!-- Mobile Internet Explorer allows us to activate ClearType technology for smoothing fonts for easy reading -->
<meta http-equiv="cleartype" content="on" />
<!-- Specify whether or not telephone numbers in the HTML content should appear as hypertext links -->
<meta name="format-detection" content="telephone=no" />
<!-- Changes the logical window size used when displaying a page mobile browsers -->
<meta name = "viewport" content = "width = device-width, initial-scale=1, user-scalable=yes" />

<meta name="robots" content="nofollow" />
<meta name="http-equiv" content="X-Robots-Tag : nofollow" />
<meta name="googlebot" content="nofollow" />
<meta name="description" content="" />
<meta name="keywords" content="matplotlib" />
<link href="design.css" rel="stylesheet" type="text/css" />
<title>気象データ解析のためのmatplotlibの使い方：インストール</title>
<meta property="og:title" content="気象データ解析のためのmatplotlibの使い方：インストール" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://yyousuke.github.io/matplotlib/matplotlib-install.html" />
<meta property="og:image" content="https://yyousuke.github.io/matplotlib/images/logo.png" />
<meta property="og:site_name" content="気象データ解析のためのmatplotlibの使い方：インストール" />
<meta property="og:description" content="macOSで構築する「気象データ解析のためのmatplotlibの使い方」のサンプルプログラム実行環境をLinux上で構築するための手順を紹介" />
<meta property="fb:app_id" content="902607720378666" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@yyousuke1109" />
<meta name="twitter:player" content="@yyousuke1109" />
</head>

<body>

<div id="nesting">
<a href="/">ホーム</a> &gt; <a href="index.html">matplotlibの使い方</a> &gt; インストール</div>
<article>
<h1 id="top">matplotlib：インストール</h1>
<br />
<div id="text2">
<p>&nbsp; ここでは、macOSで構築する「気象データ解析のためのmatplotlibの使い方」の<a href="./met_sample.zip" target="_blank">サンプルプログラム</a>実行環境を、Linux上で構築するための手順を紹介しています。導入にはパッケージ管理ツール Condaを用います。macOSでMacPortsを利用する場合には<a href="matplotlib-2.pdf">「2章　matplotlibの導入」</a>をご参照ください。</p>
<p>作成者：山下陽介（国立環境研究所）</p>
</div>
<br />
<hr />
<br />


<!-- ここから本文 -->
<h3><div class="headline1" id="install_1">準備</div></h3>
<h4><div class="headline2" id="install_1_1">パッケージ管理ツールConda</div></h4>
<div class="text1">
Python環境を構築するため、まずはパッケージ管理ツールCondaを導入します。Anacondaを導入する、軽量版のMinicondaを導入する、Intel oneAPIのcondaコマンドを利用する、など複数の方法がありますので、お好みのものをご利用ください。なお下記のツールには、Linux版の他、Windows版、macOS版もあります。
<ul class="list1">
<li><a href="https://www.python.jp/install/anaconda/unix/install.html" target="_blank">Linux版Anacondaのインストール</a></li>
<li><a href="https://www.anaconda.com/" target="_blank">Anaconda</a>（ダウンロードサイト）</li>
<li><a href="https://docs.conda.io/en/latest/miniconda.html" target="_blank">Miniconda</a>（Python環境に特化した軽量版）</li>
<li><a href="https://qiita.com/implicit_none/items/35bc4be8f2022903747a" target="_blank">Intel oneAPI Base Toolkit + HPC Toolkit (Intel Fortran)のインストール（Linux版）</a>（Intel Fortran/Pythonと共存させたい場合など）</li>
</ul>
＊macOSのMacPortsなど他のパッケージ管理ツールを利用している場合、Condaを導入すると競合が発生することがあります。
</div>

<h4><div class="headline2" id="install_1_2">Conda環境の作成</div></h4>
<div class="text1">
ここでは、conda実行環境を複数用意して、使いたい環境に切り替える方法を紹介します。Python3.12環境をpy312という名前で作成するには、次のようにします。Pythonのバージョンを変えたい場合には、python=3.12の部分を変更します。
<pre>% conda create -n py312 python=3.12</pre>
＊anacondaの場合、~/anaconda3/envs/py312/ができる<br />
＊minicondaの場合、~/anaconda3/envs/py312/ができる<br />
＊Intel oneAPIの場合、~/.conda/envs/py312/ができる<br />
作成した実行環境を次のように有効化します。
<pre>% conda activate py312</pre>
環境によってはconda activateでエラーが出ることがあるので、その場合には
<pre>% source activate py312</pre>
を試してください（csh/tcshの場合には利用不可なので、bashに切り替える）。
</div>


<h3><div class="headline1" id="install_2">パッケージのインストール</div></h3>
<h4><div class="headline2" id="install_2_1">サンプルプログラムで利用するパッケージ</div></h4>
<div class="text1">
<a href="./met_sample.zip" target="_blank">サンプルプログラム</a>では、Condaで追加導入するパッケージが必要です。インストールを行う際には、
<pre>% conda install パッケージ名</pre>
を用います。サンプルプログラムの実行に必要なパッケージは、以下の手順で導入します（python3.9以前の場合。python3.10以降の場合には、<a href="#install_2_2">python3.10以降の場合</a>参照）。
<pre>
% conda install pandas
% conda install netcdf4
% conda install basemap
% conda install cartopy
</pre>
なお、「3章　matplotlib の基本」のインタラクティブ環境を利用する場合には、次のようにipythonを導入しておきます。
<pre>
% conda install ipython
</pre>
なお、basemap_ortho.pyではLinuxのwgrib2コマンドを利用するため、試してみる場合にはインストールが必要になります。CentOS、RHEL、Alma Linux、Rocky LinuxなどRed Hat系では<a href="https://docs.fedoraproject.org/ja/epel/" target="_blank">EPEL（Extra Packages for Enterprise Linux）</a>リポジトリに含まれます（導入方法はOSやバージョンにより異なるので、EPELのリンク先を参照してください）。Ubuntuなどでは、ソースコードからビルドします（<a href="#install_2_3">Windows10/11のWSL2上のLinuxに構築する場合</a>参照）。
</div>

<h4><div class="headline2" id="install_2_2">python3.10以降の場合</div></h4>
<div class="text1">
python3.10以降では、Condaを使ってbasemapを導入できないケースがあります。その場合には、以下の手順でbasemapのみpipでインストールします（以下の例はpython3.12の場合）。
<pre>
% conda create -n py312 python=3.12
% conda activate py312
% conda install pandas
% conda install netcdf4
% conda install cartopy
% conda install lxml
% conda install scipy
% pip install basemap
% pip install basemap-data-hires
</pre>
＊-nオプションで作成する環境の名前を設定します。ここではpython3.12を表すpy312としました。<br />
既に作成されているConda環境の場合、basemapインストール時に不整合が生じることがあるため、basemap用に新規作成することを推奨します。
なお、「3章　matplotlib の基本」のインタラクティブ環境を利用する場合には、次のようにipythonを導入しておきます。
<pre>
% conda install ipython
</pre>
</div>

<h4><div class="headline2" id="install_2_3">Windows10/11のWSL2上のLinuxに構築する場合</div></h4>
<div class="text1">
Windows 10/11では、<a href="https://learn.microsoft.com/ja-jp/windows/wsl/" target="_blank">Windows Subsystem for Linux 2（WSL2）</a>を利用して、Windows上にLinux仮想マシンを構築できるようになっています。ここでは、Ubuntu 22.04上のminicondaでの導入例を示します。まずは、検索機能を使って「Power Shell」を検索し、次のように現在デフォルトとなっているUbuntu 22.04を導入します。
<pre>% wsl --install</pre>
検索機能で「wsl」を検索して起動します。Power Shell上でwslと入力しても起動できます。なお以降の手順は、物理マシンのUbuntu 22.04上にサンプルプログラム実行環境を構築する場合にも適用可能です。サンプルプログラムでは、X Window Systemを利用するため、次のように導入します。
<pre>% sudo apt install x11-apps</pre>
次に、minicondaをインストールします。
<pre>
% wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
% chmod +x Miniconda3-latest-Linux-x86_64.sh
% sh Miniconda3-latest-Linux-x86_64.sh
% . .bashrc（condaの設定を反映）
</pre>
まずは、Minicondaの環境を作成します。
<pre>% conda create -n py312 python=3.12</pre>
Minicondaの環境は~/miniconda3/envs/py312/に作成されます。Condaを使ってpython環境を整備します（<a href="#install_2_2">python3.10以降の場合</a>と同じ）。
<pre>
% conda activate py312
% conda install pandas
% conda install netcdf4
% conda install cartopy
% conda install lxml
% conda install scipy
% pip install basemap
% pip install basemap-data-hires
</pre>
<br />
met_sample.zipをダウンロードします。
<pre>% wget https://yyousuke.github.io/matplotlib/met_sample.zip</pre>
ZIPを開くためunzipをインストールしておきます。
<pre>
% sudo apt install unzip
% unzip met_sample.zip
</pre>
basemap_ortho.pyの実行に必要なwgrib2は次の手順でビルドします。なお、以前のバージョンのv.3.1.1は同様にコンパイル可能ですが、v3.1.2ではコンパイル時にエラーが出ます。
<pre>
% wget https://www.ftp.cpc.ncep.noaa.gov/wd51we/wgrib2/wgrib2.tgz.v3.1.3
% sudo apt install gcc
% sudo apt install gfortran
% sudo apt install make
% tar -zxvf wgrib2.tgz.v3.1.3
% export CC=gcc
% export FC=gfortran
% cd grib2 ; make
</pre>
なお、コンパイル時にcmakeがないというエラーが発生する場合、
<pre>% sudo apt install cmake</pre>
を行いインストールします。<br />
ビルドしたwgrib2コマンドをホームディレクトリ直下のbin/に配置する場合の例です。
<pre>
% mkdir ~/bin
% cp -p wgrib2/wgrib2 ~/bin
</pre>
常に有効にする場合には、~/.bashrcの最後に追記します。
<pre>% export PATH=”~/bin:$PATH”</pre>
現在ログインしている端末で有効にします。
<pre>% . .bashrc</pre>
この状態でサンプルプログラムが実行可能になっています。
</div>

<br />
<small><a href="#top">[top]</a></small> <br />
<hr width="105%" />
</article>
</body>
<footer>
<p>最終更新日：2024/04/26</p>
<p>Copyright (C) 2022-2024, Yousuke Yamashita, CC BY 4.0</p>
</footer>
</html>
