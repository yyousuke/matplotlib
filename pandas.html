<!doctype html>
<html>
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M077D60Y90"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M077D60Y90');
</script>

<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="author" content="山下陽介 (Yousuke Yamashita)  国立環境研究所 (National Institute for Environmental Studies, NIES)" />
<link rel="icon" type="image/vnd.microsoft.icon" href="/matplotlib/favicon.ico" />
<link rel="apple-touch-icon" type="image/png" href="/matplotlib/images/apple-touch-icon-180x180.png" />
<link rel="icon" type="image/png" href="/matplotlib/images/icon-192x192.png" />
<!-- Mobile Internet Explorer allows us to activate ClearType technology for smoothing fonts for easy reading -->
<meta http-equiv="cleartype" content="on" />
<!-- Specify whether or not telephone numbers in the HTML content should appear as hypertext links -->
<meta name="format-detection" content="telephone=no" />
<!-- Changes the logical window size used when displaying a page mobile browsers -->
<meta name = "viewport" content = "width = device-width, initial-scale=1, user-scalable=yes" />

<meta name="robots" content="all" />
<meta name="http-equiv" content="X-Robots-Tag : all" />
<meta name="googlebot" content="all" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<link href="design.css" rel="stylesheet" type="text/css" />
<title>気象データ解析のためのmatplotlibの使い方：PandasのTIPS</title>
</head>

<body>

<div id="nesting">
<a href="/">ホーム</a> &gt; <a href="index.html">matplotlibの使い方</a> &gt; pandas
</div>
<article>
<h1 id="top">PandasのTIPS</h1>
<br />

<!-- ここから本文 -->
<h3><div class="headline1" id="display">表示数を増やす</div></h3>
<div class="text1">
<ul class="list1">
<li>現在の最大列数を表示
<pre>print(pd.get_option("display.max_columns"))</pre></li>
<li>最大列数を50列にする
<pre>pd.set_option('display.max_columns', 50)</pre></li>
<li>現在の最大行数を表示
<pre>print(pd.get_option("display.max_rows"))</pre></li>
<li>最大行数を50行にする
<pre>pd.set_option('display.max_rows', 50)</pre></li>
</ul>
</div>
<br />
<br />

<h3><div class="headline1" id="df_create">DataFrameの作成</div></h3>
<div class="text1">
<ul class="list1">
<li>Numpyのndarrayから作成する方法
<pre>df = pd.DataFrame(
&nbsp; &nbsp; {
&nbsp; &nbsp; &nbsp; &nbsp; 'index': np.array(index),
&nbsp; &nbsp; &nbsp; &nbsp; 'mean': np.array(dmean),
&nbsp; &nbsp; &nbsp; &nbsp; 'std': np.array(dstd)
&nbsp; &nbsp; },
&nbsp; &nbsp; dtype='float')
</pre>
インデックスをindex、平均値をdmean、標準偏差をdstdに格納した場合<br />
dtype=np.float32等も可能
</li><br />
<li>indexがDatetimeIndexの場合
<pre>df = pd.DataFrame(
&nbsp; &nbsp; {
&nbsp; &nbsp; &nbsp; &nbsp; 'index': list(index),
&nbsp; &nbsp; &nbsp; &nbsp; 'mean': np.array(dmean),
&nbsp; &nbsp; &nbsp; &nbsp; 'std': np.array(dstd)
&nbsp; &nbsp; })
</pre>
dtypeの指定を行うと警告が出る
</li><br />
<li>別の2次元配列dから作成する場合
<pre>df = pd.DataFrame(d, index=index_list, columns=columns_list)
</pre>
index_listのサイズは行数、columns_listのサイズは列数と一致させる
</li><br />
<li>csvファイルから作成する方法
<pre>df = pd.read_csv("ファイル名")</pre></li>
<li>読み込んだwebページから作成する方法
<pre>df = pd.io.html.read_html("URL")</pre>
＊テーブルになっているページから数値を取り出す
</li><br />
</ul>
</div>
<br />
<br />

<h3><div class="headline1" id="add">データの追加</div></h3>
<div class="text1">
<ul class="list1">
<li>ndarrayに列ラベルを付けて追加
<pre>df['列ラベル'] = np.array(データ)</pre>
データの個数はdfの行数と一致している必要あり
</li><br />
<li>列同士の演算結果を追加
<pre>df['列ラベル'] = df.loc['列1'] - df.loc['列2']</pre>
</li>
</ul>
</div>
<br />
<br />

<h3><div class="headline1" id="resample">リサンプリング</div></h3>
<div class="text1">
<ul class="list1">
<li>時間軸のデータを日平均する方法
<pre>df_new = df.resample('D').mean()</pre></li>
<li>時間軸のデータを日毎に合計する方法
<pre>df_new = df.resample('D').sum()</pre></li>
<li>時間軸のデータを月平均する方法
<pre>df_new = df.resample('M').mean()</pre></li>
<li>時間軸のデータを月毎に合計する方法
<pre>df_new = df.resample('M').sum()</pre></li>
</ul>
</div>
<br />
<br />

<h3><div class="headline1" id="df_select">データの選択</div></h3>
<div class="text1">
<ul class="list1">
<li>配列の番号で選択する場合
<pre>df_new = df.iloc[:, 0]</pre>
dfが２次元配列の場合。axis=1の0番目の要素を選択
</li><br />
<li>配列のラベルで選択する場合
<pre>df_new = df.loc[:, "lab"]</pre>
dfが２次元配列の場合。labという名前の列を選択
</li><br />
<li>条件により選択（Aが正の場合）
<pre>df_new = df[A &gt;= 0]</pre>
Aはdfと同じサイズで条件を表す配列
</li><br />
</ul>
</div>
<br />
<br />

<h3><div class="headline1" id="df_replace">データの置き換え</div></h3>
<div class="text1">
<ul class="list1">
<li>別のデータから置き換え
<pre>df.iloc[:, 0] = np.array(data)</pre>
dfが２次元配列の場合。axis=1の0番目の要素を選択し、dataで置き換える
</li><br />
<li>条件により選択（負の場合にNaN）
<pre>df[df &lt; 0] = np.nan</pre>
</li><br />
<li>条件により選択（qaが50%未満の場合にNaN）
<pre>df[qa &lt; 50] = np.nan</pre>
qaはdfと同じサイズの配列
</li><br />
<li>文字列の置き換え（正規表現を含む）
<pre>df.iloc[:, 0].str.replace("文字列（正規表現を含む）", "置換する文字列", regex=True)</pre>
dfのaxis=1の0番目の要素を全て置き換える
</li><br />
<li>文字列の置き換え（正規表現を含まない）
<pre>df.iloc[:, 0].str.replace("文字列（正規表現を含まない）", "置換する文字列", regex=False)</pre>
</li><br />
<li>文字列の置き換え（大文字小文字を区別する）
<pre>df.iloc[:, 0].str.replace("文字列", "置換する文字列", regex=False, case=True)</pre>
</li><br />
</ul>
</div>
<br />
<br />

<h3><div class="headline1" id="df_sort">データの並べ替え</div></h3>
<div class="text1">
DataFrameのsort_values()メソッドを使う
<ul class="list1">
<li>基準となる列のラベルを指定して並べ替える
<pre>df_2 = df.sort_values('列の名前')</pre>
デフォルトは昇順
</li><br />
<li>降順で並べ替える
<pre>df_2 = df.sort_values('列の名前', ascending=False)</pre>
</li><br />
<li>複数列を基準として並べ替える
<pre>df_2 = df.sort_values(['列の名前1', 列の名前2'])</pre>
列のリストの後ろから順にソートされる
</li><br />
<li>複数列で昇順・降順を指定する
<pre>df_2 = df.sort_values(['列の名前1', 列の名前2'], ascending=[False, True])</pre>
列の名前1は降順、列の名前2は昇順
</li><br />
<li>欠損値を最初に並べる
<pre>df_2 = df.sort_values('列の名前', na_position='first')</pre>
デフォルトでは最後に並ぶ
</li><br />
</ul>
</div>
<br />
<br />


<h3><div class="headline1" id="df_info">データの情報を表示</div></h3>
<div class="text1">
<ul class="list1">
<li>行数・列数、データ列の名前などを表示
<pre>df.info()</pre>
DataFrame（df）のdf.info()メソッドを使う<br />
行数・列数、データ列の名前、データ型、メモリサイズなどが表示できる
</li><br />
<li>データ行の名前を取得する
<pre>print(df.index)</pre>
</li><br />
<li>データ列の名前を取得する
<pre>print(df.columns)</pre>
</li><br />
<li>行数を取得する
<pre>print(len(df))</pre>
</li><br />
<li>列数を取得する
<pre>print(len(df.columns))</pre>
</li><br />
<li>サイズを取得する
<pre>print(df.size)</pre>
行数&times;列数と一致
</li><br />
<li>形状を取得する
<pre>print(df.shape)</pre>
軸の番号順に要素となったタプルとして表示
</li><br />
</ul>
</div>
<br />
<br />


<br />
<br />
<br />
<br />

<small><a href="#top">[top]</a></small> <br />
<hr width="105%" />
</article>
</body>
<footer>
<p>最終更新日：2023/04/27</p>
<p>Copyright (C) 2021-2023, Yousuke Yamashita, CC BY 4.0</p>
</footer>
</html>